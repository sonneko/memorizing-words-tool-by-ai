(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2970:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>I});var a=r(5155),o=r(2115),n=r(9434);let s=e=>{let{lines:t}=e,r=(0,o.useRef)(null);(0,o.useEffect)(()=>{var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]);let s=e=>{switch(e){case"error":return"text-destructive";case"success":return"text-green-400";case"info":return"text-blue-400";case"prompt":case"user":return"text-primary";case"question":return"text-yellow-400";case"header":return"font-bold text-foreground mb-1";default:return"text-foreground"}};return(0,a.jsxs)("div",{className:"flex-grow overflow-y-auto p-2 space-y-1 whitespace-pre-wrap break-words",children:[t.map(e=>(0,a.jsxs)("div",{className:(0,n.cn)("flex","user"===e.type?"pl-0":""),children:["user"!==e.type&&"prompt"!==e.type&&(0,a.jsx)("span",{className:"mr-2 opacity-60",children:">"}),(0,a.jsx)("div",{className:(0,n.cn)(s(e.type),"flex-1"),children:e.content})]},e.id)),(0,a.jsx)("div",{ref:r})]})},i=e=>{let{className:t}=e;return(0,a.jsx)("span",{className:(0,n.cn)("inline-block h-[1.1em] w-[0.5em] bg-primary align-text-bottom blinking-cursor",t),"aria-hidden":"true"})},l={LEARN:"1",REVIEW:"2",SEARCH:"3",LOAD_VOCAB:"4",EXIT:"5"},c={WELCOME:"Welcome to ".concat("LexiCLI","!"),LOADING_VOCAB:"Loading vocabulary...",VOCAB_LOAD_SUCCESS:e=>"".concat(e," words loaded successfully."),VOCAB_LOAD_ERROR:"Error loading vocabulary. The application cannot start.",MAIN_MENU_HEADER:"Main Menu:",MENU_LEARN:"".concat(l.LEARN,". 学習セッション (Learn new words)"),MENU_REVIEW:"".concat(l.REVIEW,". 間違えた単語レビュー (Review missed words)"),MENU_SEARCH:"".concat(l.SEARCH,". 単語検索 (Search words)"),MENU_LOAD_VOCAB:"".concat(l.LOAD_VOCAB,". 単語ファイル読込 (Load vocabulary file)"),MENU_EXIT:"".concat(l.EXIT,". 終了 (Exit)"),CHOOSE_OPTION:"Choose an option: ",INVALID_OPTION:"Invalid option. Please try again.",ENTER_RANGE:"Enter index range (e.g., 1-100, or 'all'): ",INVALID_RANGE:"Invalid range. Please use format 'start-end' (e.g. 1-50) or 'all'. Max range is ",CHOOSE_DIRECTION:"Choose learning direction (1: English -> Japanese, 2: Japanese -> English): ",INVALID_DIRECTION:"Invalid direction. Please enter 1 or 2.",STARTING_SESSION:"Starting session...",QUIZ_PROMPT:"Your answer ('q' to quit): ",CORRECT:"Correct!",INCORRECT_PREFIX:"Incorrect. Correct answer: ",SESSION_INTERRUPTED:"Session interrupted.",SESSION_SUMMARY:(e,t)=>"Session finished. Correct: ".concat(e,"/").concat(t," (").concat((e/t*100||0).toFixed(1),"%)."),NO_MISSED_WORDS:"No words missed in this session!",ENTER_TEST_NAME:"Enter a name for this missed words list (or press Enter to skip saving): ",TEST_NAME_EMPTY_SKIP:"Skipped saving missed words.",SAVING_MISSED_WORDS:"Saving missed words...",MISSED_WORDS_SAVED:e=>"Missed words saved as '".concat(e,"'."),MISSED_WORDS_SAVE_ERROR:"Error saving missed words.",CHOOSE_REVIEW_TEST:"Enter the name of the test to review (or 'ls' to list tests, 'menu' to return): ",AVAILABLE_TESTS:"Available tests:",NO_TESTS_FOUND:"No saved tests found.",TEST_NOT_FOUND:e=>"Test '".concat(e,"' not found or is empty."),LOADING_TEST:e=>"Loading test '".concat(e,"'..."),REVIEW_ALL_CORRECT:"All words in this review test were answered correctly! Test list updated.",REVIEW_UPDATED:e=>"Test '".concat(e,"' updated. Correctly answered words removed."),REVIEW_UPDATE_ERROR:"Error updating review test.",ENTER_SEARCH_TERM:"Enter search term: ",SEARCHING:"Searching...",SEARCH_RESULTS_HEADER:"Search Results:",NO_SEARCH_RESULTS:"No words found matching your search.",PRESS_ANY_KEY_CONTINUE:"Press Enter to continue...",EXIT_MESSAGE:"Thank you for using LexiCLI! Closing session.",INDEXEDDB_NOT_SUPPORTED:"IndexedDB is not supported in your browser. Progress and custom vocabulary may not be saved.",INDEXEDDB_ERROR:"An error occurred with the database.",LISTING_TESTS_ERROR:"Could not retrieve test list.",LOADING_FROM_INDEXEDDB:"Attempting to load vocabulary from local storage...",LOADED_FROM_INDEXEDDB_SUCCESS:e=>"Loaded ".concat(e," words from local storage."),INDEXEDDB_EMPTY_FALLBACK_FETCH:"No vocabulary found in local storage or error occurred. Attempting to fetch default vocabulary...",FETCH_FALLBACK_SUCCESS_SAVED_INDEXEDDB:"Default vocabulary loaded and saved to local storage.",FETCH_FALLBACK_FAIL:"Failed to load default vocabulary. You can try loading a file with 'loadvocab' command.",PROMPT_LOAD_VOCAB_FILE:"Please select a '.json' vocabulary file.",VOCAB_FILE_SELECTED:e=>"Selected file: ".concat(e,". Processing..."),VOCAB_FILE_LOAD_SUCCESS:e=>"Successfully loaded and saved ".concat(e," words from file."),VOCAB_FILE_LOAD_INVALID:"Invalid file format. The file must be a JSON array of {'ja': string, 'en': string} objects.",VOCAB_FILE_LOAD_ERROR:e=>"Error loading vocabulary file: ".concat(e),VOCAB_FILE_NO_FILE_SELECTED:"No file selected. Returning to menu."},E=(0,o.forwardRef)((e,t)=>{let{promptSymbol:r="> ",onInputChange:o,currentValue:s,isFocused:l=!0,className:c,...E}=e;return(0,a.jsxs)("div",{className:(0,n.cn)("flex items-center p-2 border-t border-border",c),children:[(0,a.jsx)("span",{className:"text-primary mr-1",children:r}),l&&(0,a.jsx)(i,{className:"mr-1"})," ",(0,a.jsx)("input",{ref:t,type:"text",value:s,onChange:e=>o(e.target.value),className:"flex-grow bg-transparent text-input-foreground focus:outline-none placeholder-muted-foreground pl-0.5",autoFocus:!0,spellCheck:"false",autoComplete:"off",...E})]})});E.displayName="CliInput";let d="missedWords",u="vocabulary",_="mainVocabulary",S=()=>{let[e,t]=(0,o.useState)(null),[r,a]=(0,o.useState)(null),n=(0,o.useCallback)(()=>new Promise((e,r)=>{if(!("indexedDB"in window)){a("IndexedDB not supported."),r(Error("IndexedDB not supported."));return}let o=indexedDB.open("LexiCliDB",2);o.onerror=e=>{var t;a("IndexedDB error: ".concat(null===(t=o.error)||void 0===t?void 0:t.message)),r(o.error)},o.onsuccess=r=>{let a=o.result;t(a),e(a)},o.onupgradeneeded=e=>{let t=o.result;t.objectStoreNames.contains(d)||t.createObjectStore(d,{keyPath:"testName"}),t.objectStoreNames.contains(u)||t.createObjectStore(u,{keyPath:"key"})}}),[]);(0,o.useEffect)(()=>{n().catch(e=>console.error("Failed to initialize DB:",e))},[n]);let s=(0,o.useCallback)(async(t,r)=>{if(!e)throw a("DB not initialized."),Error("DB not initialized.");return new Promise((o,n)=>{let s=e.transaction([d],"readwrite").objectStore(d),i=s.get(t);i.onsuccess=()=>{let e=i.result?i.result.words:[],l=new Map;e.forEach(e=>l.set(e.en.toLowerCase(),e)),r.forEach(e=>l.set(e.en.toLowerCase(),e));let c=Array.from(l.values()),E=s.put({testName:t,words:c});E.onsuccess=()=>o(),E.onerror=()=>{var e;a("Failed to save data: ".concat(null===(e=E.error)||void 0===e?void 0:e.message)),n(E.error)}},i.onerror=()=>{var e;a("Failed to get existing data: ".concat(null===(e=i.error)||void 0===e?void 0:e.message)),n(i.error)}})},[e]),i=(0,o.useCallback)(async t=>{let r=e;if(!r)try{r=await n()}catch(e){throw a("DB not initialized and re-initialization failed for loadData."),Error("DB not initialized and re-initialization failed for loadData.")}if(!r)throw a("DB is null after initDB for loadData."),Error("DB is null after initDB for loadData.");return new Promise((e,o)=>{let n=r.transaction([d],"readonly").objectStore(d).get(t);n.onsuccess=()=>e(n.result?n.result.words:null),n.onerror=()=>{var e;a("Failed to load data: ".concat(null===(e=n.error)||void 0===e?void 0:e.message)),o(n.error)}})},[e,n]),l=(0,o.useCallback)(async(t,r)=>{if(!e)throw a("DB not initialized."),Error("DB not initialized.");return new Promise((o,n)=>{let s=e.transaction([d],"readwrite").objectStore(d).put({testName:t,words:r});s.onsuccess=()=>o(),s.onerror=()=>{var e;a("Failed to update data: ".concat(null===(e=s.error)||void 0===e?void 0:e.message)),n(s.error)}})},[e]),c=(0,o.useCallback)(async t=>{if(!e)throw a("DB not initialized."),Error("DB not initialized.");return new Promise((r,o)=>{let n=e.transaction([d],"readwrite").objectStore(d).delete(t);n.onsuccess=()=>r(),n.onerror=()=>{var e;a("Failed to delete test: ".concat(null===(e=n.error)||void 0===e?void 0:e.message)),o(n.error)}})},[e]),E=(0,o.useCallback)(async()=>{let t=e;if(!t)try{t=await n()}catch(e){throw a("DB not initialized and re-initialization failed for getAllTestNames."),Error("DB not initialized and re-initialization failed for getAllTestNames.")}if(!t)throw a("DB is null after initDB for getAllTestNames."),Error("DB is null after initDB for getAllTestNames.");return new Promise((e,r)=>{let o=t.transaction([d],"readonly").objectStore(d).getAllKeys();o.onsuccess=()=>e(o.result),o.onerror=()=>{var e;a("Failed to get all test names: ".concat(null===(e=o.error)||void 0===e?void 0:e.message)),r(o.error)}})},[e,n]),S=(0,o.useCallback)(async t=>{if(!e)throw a("DB not initialized for saving vocabulary."),Error("DB not initialized for saving vocabulary.");return new Promise((r,o)=>{let n=e.transaction([u],"readwrite").objectStore(u).put({key:_,words:t});n.onsuccess=()=>r(),n.onerror=()=>{var e;a("Failed to save vocabulary: ".concat(null===(e=n.error)||void 0===e?void 0:e.message)),o(n.error)}})},[e]),f=(0,o.useCallback)(async()=>{let t=e;if(!t)try{t=await n()}catch(e){throw a("DB not initialized and re-initialization failed for loadMainVocabulary."),Error("DB not initialized and re-initialization failed for loadMainVocabulary.")}if(!t)throw a("DB is null after initDB for loadMainVocabulary."),Error("DB is null after initDB for loadMainVocabulary.");return new Promise((e,r)=>{let o=t.transaction([u],"readonly").objectStore(u).get(_);o.onsuccess=()=>e(o.result?o.result.words:null),o.onerror=()=>{var e;a("Failed to load main vocabulary: ".concat(null===(e=o.error)||void 0===e?void 0:e.message)),r(o.error)}})},[e,n]);return{db:e,error:r,initDB:n,saveData:s,loadData:i,updateTestData:l,deleteTest:c,getAllTestNames:E,saveVocabulary:S,loadMainVocabulary:f}};var f=r(7481);let R=()=>{let[e,t]=(0,o.useState)([]),[r,a]=(0,o.useState)(""),[s,i]=(0,o.useState)("LOADING"),[E,d]=(0,o.useState)([]),[u,_]=(0,o.useState)(-1),[R,I]=(0,o.useState)([]),[N,A]=(0,o.useState)(!0),[D,O]=(0,o.useState)(null),[T,g]=(0,o.useState)(null),[C,m]=(0,o.useState)(""),{db:h,error:v,saveData:w,loadData:L,updateTestData:p,deleteTest:y,getAllTestNames:b,saveVocabulary:M,loadMainVocabulary:V}=S(),{toast:B}=(0,f.dj)(),U=(0,o.useRef)(null),[P,x]=(0,o.useState)(!1),F=(0,o.useCallback)(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"system";t(t=>{let a=[...t,{id:(0,n.$C)(),type:r,content:e,timestamp:Date.now()}];return a.length>200?a.slice(a.length-200):a})},[]),k=(0,o.useCallback)(e=>{F(e,"prompt")},[F]),j=(0,o.useCallback)(async()=>{if(A(!0),i("LOADING"),F(c.LOADING_VOCAB),h)try{F(c.LOADING_FROM_INDEXEDDB);let e=await V();if(e&&e.length>0){I(e),F(c.LOADED_FROM_INDEXEDDB_SUCCESS(e.length),"success"),i("MENU"),A(!1);return}F(c.INDEXEDDB_EMPTY_FALLBACK_FETCH)}catch(e){console.error("Failed to load vocab from IndexedDB:",e),F(c.INDEXEDDB_EMPTY_FALLBACK_FETCH+(e.message?" (".concat(e.message,")"):""),"error")}else F("Database not ready, attempting to fetch default vocabulary...");try{let e=await fetch("/vocab.json");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=await e.json();if(I(t),F(c.VOCAB_LOAD_SUCCESS(t.length),"success"),h)try{await M(t),F(c.FETCH_FALLBACK_SUCCESS_SAVED_INDEXEDDB,"info")}catch(e){console.error("Failed to save fetched vocab to IndexedDB:",e),F("Info: Could not save fetched vocabulary to local storage. (".concat(e.message,")"),"info")}i("MENU")}catch(e){console.error("Failed to load vocabulary from fetch:",e),F(c.VOCAB_LOAD_ERROR+(e.message?" (".concat(e.message,")"):""),"error"),F("You can try loading a vocabulary file using the 'loadvocab' command.","info"),i("MENU")}finally{A(!1)}},[F,h,V,M]);(0,o.useEffect)(()=>{h&&j()},[h,j]);let W=(0,o.useCallback)(()=>{F(c.MAIN_MENU_HEADER,"header"),F(c.MENU_LEARN),F(c.MENU_REVIEW),F(c.MENU_SEARCH),F(c.MENU_LOAD_VOCAB),F(c.MENU_EXIT),k(c.CHOOSE_OPTION),i("MENU")},[F,k]);(0,o.useEffect)(()=>{"MENU"!==s||N||W()},[s,N,W]),(0,o.useEffect)(()=>{U.current&&"LOADING"!==s&&"EXITED"!==s&&U.current.focus()},[e,s]);let H=(0,o.useCallback)(async e=>{if(F("".concat("> ").concat(e),"user"),a(""),""!==e.trim()&&(0===E.length||E[E.length-1]!==e)&&d(t=>[...t,e]),_(-1),("LEARNING"===s||"REVIEWING"===s)&&"q"===e.toLowerCase()){if("LEARNING"===s&&D){F(c.SESSION_INTERRUPTED,"info");let{correctAnswers:e,currentIndex:t,missedInSession:r}=D;F(c.SESSION_SUMMARY(e,t),"info"),r.length>0?(i("LEARN_SAVE_TESTNAME"),k(c.ENTER_TEST_NAME)):(F(c.NO_MISSED_WORDS,"success"),i("MENU")),O(e=>e?{...e,currentIndex:e.words.length}:null)}else if("REVIEWING"===s&&T){F(c.SESSION_INTERRUPTED,"info");let{correctAnswers:e,currentIndex:t,missedInSession:r,testName:a,initialWords:o}=T;F(c.SESSION_SUMMARY(e,t),"info");let n=o.filter(e=>!T.words.slice(0,t).find(t=>t.en===e.en&&!r.find(e=>e.en===t.en)));h&&a&&(0===n.length?(await y(a),F("Test '".concat(a,"' is now empty and has been removed."),"success")):(await p(a,n),F(c.REVIEW_UPDATED(a),"success"))),g(e=>e?{...e,currentIndex:e.words.length}:null),i("MENU")}return}switch(s){case"MENU":G(e);break;case"LEARN_RANGE":X(e);break;case"LEARN_DIRECTION":z(e);break;case"LEARNING":K(e);break;case"LEARN_SAVE_TESTNAME":await Q(e);break;case"REVIEW_CHOOSE_TEST":await q(e);break;case"REVIEWING":Z(e);break;case"SEARCH_TERM":$(e);break;case"SEARCH_RESULTS":case"LOAD_VOCAB_FILE":i("MENU");break;default:F("Unknown mode or command: ".concat(e),"error"),i("MENU")}},[s,F,k,R,D,T,h,E,w,L,p,y,b,W,M]),G=e=>{switch(e){case l.LEARN:i("LEARN_RANGE"),k(c.ENTER_RANGE+"(1-".concat(R.length,")"));break;case l.REVIEW:i("REVIEW_CHOOSE_TEST"),k(c.CHOOSE_REVIEW_TEST);break;case l.SEARCH:i("SEARCH_TERM"),k(c.ENTER_SEARCH_TERM);break;case l.LOAD_VOCAB:i("LOAD_VOCAB_FILE"),x(!0),k(c.PROMPT_LOAD_VOCAB_FILE);break;case l.EXIT:F(c.EXIT_MESSAGE,"info"),i("EXITED");break;default:F(c.INVALID_OPTION,"error"),k(c.CHOOSE_OPTION)}},X=e=>{if(0===R.length){F("Vocabulary is empty. Please load a vocabulary file first using 'loadvocab'.","error"),i("MENU");return}let t=(0,n.RC)(e,R.length);if(!t){F(c.INVALID_RANGE+R.length,"error"),k(c.ENTER_RANGE+"(1-".concat(R.length,")"));return}let r=R.slice(t[0],t[1]+1);if(0===r.length){F("Selected range is empty or invalid.","error"),k(c.ENTER_RANGE+"(1-".concat(R.length,")"));return}O({words:(0,n.R3)(r),currentIndex:0,correctAnswers:0,totalQuestions:r.length,missedInSession:[],direction:"en-to-ja",originalRange:e}),i("LEARN_DIRECTION"),k(c.CHOOSE_DIRECTION)},z=e=>{if(D){if("1"===e||"2"===e){let t="1"===e?"en-to-ja":"ja-to-en";O(e=>e?{...e,direction:t}:null),i("LEARNING"),Y({...D,direction:t})}else F(c.INVALID_DIRECTION,"error"),k(c.CHOOSE_DIRECTION)}},Y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;if(!e||e.currentIndex>=e.words.length){var t,r;F(c.SESSION_SUMMARY(null!==(t=null==e?void 0:e.correctAnswers)&&void 0!==t?t:0,null!==(r=null==e?void 0:e.totalQuestions)&&void 0!==r?r:0),"info"),e&&e.missedInSession.length>0?(i("LEARN_SAVE_TESTNAME"),k(c.ENTER_TEST_NAME)):(F(c.NO_MISSED_WORDS,"success"),i("MENU"));return}let a=e.words[e.currentIndex],o="en-to-ja"===e.direction?a.en:a.ja;F("Q: ".concat(o),"question"),k(c.QUIZ_PROMPT)},K=e=>{if(!D)return;let t=D.words[D.currentIndex],r=(0,n.dG)(e,t,D.direction),a=D.correctAnswers,o=[...D.missedInSession];if(r)F(c.CORRECT,"success"),a++;else{let e="en-to-ja"===D.direction?t.ja:t.en;F("".concat(c.INCORRECT_PREFIX).concat(e),"error"),o.find(e=>e.en===t.en)||o.push(t)}let s={...D,correctAnswers:a,missedInSession:o,currentIndex:D.currentIndex+1};O(s),Y(s)},Q=async e=>{let t=e.trim();if(!D||0===D.missedInSession.length){i("MENU");return}if(!t){F(c.TEST_NAME_EMPTY_SKIP,"info"),i("MENU");return}if(!h){F(c.INDEXEDDB_NOT_SUPPORTED,"error"),i("MENU");return}try{F(c.SAVING_MISSED_WORDS,"info"),await w(t,D.missedInSession),F(c.MISSED_WORDS_SAVED(t),"success"),B({title:"List Saved",description:"Missed words saved as '".concat(t,"'.")})}catch(e){console.error(e),F(c.MISSED_WORDS_SAVE_ERROR+(e.message?" (".concat(e.message,")"):""),"error"),B({title:"Save Error",description:c.MISSED_WORDS_SAVE_ERROR,variant:"destructive"})}finally{O(null),i("MENU")}},q=async e=>{let t=e.trim().toLowerCase();if("menu"===t){i("MENU");return}if("ls"===t){if(!h){F(c.INDEXEDDB_NOT_SUPPORTED,"error"),k(c.CHOOSE_REVIEW_TEST);return}try{let e=await b();0===e.length?F(c.NO_TESTS_FOUND,"info"):(F(c.AVAILABLE_TESTS,"header"),e.forEach(e=>F("- ".concat(e))))}catch(e){F(c.LISTING_TESTS_ERROR+(e.message?" (".concat(e.message,")"):""),"error")}k(c.CHOOSE_REVIEW_TEST);return}let r=e.trim();if(!r){k(c.CHOOSE_REVIEW_TEST);return}if(m(r),!h){F(c.INDEXEDDB_NOT_SUPPORTED,"error"),i("MENU");return}try{F(c.LOADING_TEST(r),"info");let e=await L(r);if(!e||0===e.length){F(c.TEST_NOT_FOUND(r),"error"),k(c.CHOOSE_REVIEW_TEST);return}let t={words:(0,n.R3)(e),initialWords:[...e],currentIndex:0,correctAnswers:0,totalQuestions:e.length,missedInSession:[],direction:"en-to-ja",testName:r};g(t),i("REVIEWING"),J(t)}catch(e){console.error(e),F(c.INDEXEDDB_ERROR+(e.message?" (".concat(e.message,")"):""),"error"),k(c.CHOOSE_REVIEW_TEST)}},J=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T;if(!e||e.currentIndex>=e.words.length){var t,r;if(F(c.SESSION_SUMMARY(null!==(t=null==e?void 0:e.correctAnswers)&&void 0!==t?t:0,null!==(r=null==e?void 0:e.totalQuestions)&&void 0!==r?r:0),"info"),e){let{testName:t,initialWords:r,missedInSession:a,correctAnswers:o,totalQuestions:n}=e,s=r.filter(e=>a.some(t=>t.en===e.en));o===n&&n>0?h&&t&&y(t).then(()=>{F(c.REVIEW_ALL_CORRECT,"success"),F("Test '".concat(t,"' has been removed as all words were answered correctly."),"info"),B({title:"Test Completed!",description:"Test '".concat(t,"' removed.")})}).catch(e=>{F(c.REVIEW_UPDATE_ERROR+(e.message?" (".concat(e.message,")"):""),"error"),console.error("Error deleting test:",e)}):h&&t&&(s.length>0?p(t,s).then(()=>{F(c.REVIEW_UPDATED(t),"success"),B({title:"Test Updated",description:"Test '".concat(t,"' updated.")})}).catch(e=>{F(c.REVIEW_UPDATE_ERROR+(e.message?" (".concat(e.message,")"):""),"error"),console.error("Error updating test data:",e)}):r.length>0&&y(t).then(()=>{F("All words in '".concat(t,"' answered or removed. Test deleted."),"success"),B({title:"Test Cleared!",description:"Test '".concat(t,"' cleared and removed.")})}).catch(e=>{F(c.REVIEW_UPDATE_ERROR+(e.message?" (".concat(e.message,")"):""),"error"),console.error("Error deleting empty test:",e)}))}g(null),i("MENU");return}let a=e.words[e.currentIndex],o="en-to-ja"===e.direction?a.en:a.ja;F("Q: ".concat(o),"question"),k(c.QUIZ_PROMPT)},Z=e=>{if(!T)return;let t=T.words[T.currentIndex],r=(0,n.dG)(e,t,T.direction),a=T.correctAnswers,o=[...T.missedInSession];if(r)F(c.CORRECT,"success"),a++;else{let e="en-to-ja"===T.direction?t.ja:t.en;F("".concat(c.INCORRECT_PREFIX).concat(e),"error"),o.find(e=>e.en===t.en)||o.push(t)}let s={...T,correctAnswers:a,missedInSession:o,currentIndex:T.currentIndex+1};g(s),J(s)},$=e=>{let t=e.trim().toLowerCase();if(!t){k(c.ENTER_SEARCH_TERM);return}if(F(c.SEARCHING,"info"),0===R.length){F("Vocabulary is empty. Cannot perform search.","info"),k(c.PRESS_ANY_KEY_CONTINUE),i("SEARCH_RESULTS");return}let r=R.filter(e=>e.en.toLowerCase().includes(t)||e.ja.toLowerCase().includes(t));r.length>0?(F(c.SEARCH_RESULTS_HEADER,"header"),r.forEach(e=>F((0,n.FS)(e)))):F(c.NO_SEARCH_RESULTS,"info"),k(c.PRESS_ANY_KEY_CONTINUE),i("SEARCH_RESULTS")},ee=async(e,t)=>{F(c.VOCAB_FILE_SELECTED(t));try{let r=JSON.parse(e);if(Array.isArray(r)&&r.every(e=>"string"==typeof e.ja&&"string"==typeof e.en)){if(!h){F(c.INDEXEDDB_NOT_SUPPORTED,"error"),F(c.VOCAB_FILE_LOAD_ERROR("Database not available to save vocabulary."),"error"),i("MENU");return}await M(r),I(r),F(c.VOCAB_FILE_LOAD_SUCCESS(r.length),"success"),B({title:"Vocabulary Loaded",description:"Loaded ".concat(r.length," words from ").concat(t,".")})}else throw Error("Invalid JSON structure.")}catch(e){console.error("Error processing vocab file:",e),F(c.VOCAB_FILE_LOAD_INVALID+(e.message?" (".concat(e.message,")"):""),"error"),B({title:"Load Error",description:c.VOCAB_FILE_LOAD_INVALID,variant:"destructive"})}finally{i("MENU")}};return(0,o.useEffect)(()=>{v&&(F("Database Error: ".concat(v),"error"),B({title:"Database Error",description:v,variant:"destructive"}))},[v,F,B]),{output:e,inputValue:r,mode:s,isLoading:N,inputRef:U,handleInputChange:e=>{a(e)},processCommand:H,handleKeyDown:e=>{if("Enter"===e.key)e.preventDefault(),H(r);else if("ArrowUp"===e.key){if(e.preventDefault(),E.length>0){let e=-1===u?E.length-1:Math.max(0,u-1);_(e),a(E[e])}}else if("ArrowDown"===e.key&&(e.preventDefault(),E.length>0&&-1!==u)){let e=Math.min(E.length-1,u+1);e>=u&&u<E.length-1?(_(e),a(E[e])):(_(-1),a(""))}},showMenu:W,isFileLoadRequested:P,clearFileLoadRequest:()=>x(!1),processLoadedVocabData:ee}};function I(){let{output:e,inputValue:t,mode:r,isLoading:n,inputRef:i,handleInputChange:l,processCommand:d,handleKeyDown:u,isFileLoadRequested:_,clearFileLoadRequest:S,processLoadedVocabData:f}=R(),I=(0,o.useRef)(null);(0,o.useEffect)(()=>{"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>console.log("SW registered: ",e)).catch(e=>console.log("SW registration failed: ",e))})},[]),(0,o.useEffect)(()=>{let e=e=>{i.current&&e.target&&!e.target.closest("button, a, input, textarea")&&i.current.focus()};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[i]),(0,o.useEffect)(()=>{_&&I.current&&(I.current.click(),S())},[_,S]);let N=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){let t=new FileReader;t.onload=async e=>{var t;let a=null===(t=e.target)||void 0===t?void 0:t.result;"string"==typeof a?await f(a,r.name):console.error("File content is not a string.")},t.onerror=()=>{console.error("Error reading file.")},t.readAsText(r),e.target&&(e.target.value="")}else d(c.VOCAB_FILE_NO_FILE_SELECTED)};return(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-background text-foreground font-mono text-sm",children:[(0,a.jsx)("input",{type:"file",ref:I,style:{display:"none"},accept:".json",onChange:N}),(0,a.jsx)(s,{lines:e}),"LOADING"!==r&&"ERROR"!==r&&"EXITED"!==r&&(0,a.jsx)(E,{ref:i,currentValue:t,onInputChange:l,onKeyDown:u,onSubmit:e=>{e.preventDefault(),d(t)},disabled:n,isFocused:!0}),"ERROR"===r&&!n&&(0,a.jsx)("div",{className:"p-2 text-destructive",children:c.VOCAB_LOAD_ERROR})]})}},5075:(e,t,r)=>{Promise.resolve().then(r.bind(r,2970))},7481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>u});var a=r(2115);let o=0,n=new Map,s=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),E({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?s(r):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function E(e){c=i(c,e),l.forEach(e=>{e(c)})}function d(e){let{...t}=e,r=(o=(o+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>E({type:"DISMISS_TOAST",toastId:r});return E({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>E({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function u(){let[e,t]=a.useState(c);return a.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>E({type:"DISMISS_TOAST",toastId:e})}}},9434:(e,t,r)=>{"use strict";r.d(t,{$C:()=>E,FS:()=>d,R3:()=>s,RC:()=>i,cn:()=>n,dG:()=>c});var a=r(2596),o=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,a.$)(t))}function s(e){let t=[...e];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}let i=(e,t)=>{if("all"===e.toLowerCase())return[0,t-1];let r=e.split("-");if(2!==r.length)return null;let a=parseInt(r[0],10),o=parseInt(r[1],10);return isNaN(a)||isNaN(o)||a<1||o>t||a>o?null:[a-1,o-1]},l=e=>e.replace(/\（[^）]*\）|\([^)]*\)/g,"").split(/[；，;,]/).map(e=>e.trim().toLowerCase()).filter(e=>e.length>0),c=(e,t,r)=>{let a=e.toLowerCase().trim();if("ja-to-en"===r)return a===t.en.toLowerCase().trim();{let e=l(t.ja);if(0===e.length)return!1;let r=e[0];if(r.startsWith("を")||r.startsWith("に")){if(a===r||a===r.substring(1))return!0}else if(a===r)return!0;for(let t=1;t<e.length;t++)if(a===e[t])return!0;return!1}},E=()=>Math.random().toString(36).substring(2,9),d=e=>"".concat(e.en," - ").concat(e.ja)}},e=>{var t=t=>e(e.s=t);e.O(0,[277,441,684,358],()=>t(5075)),_N_E=e.O()}]);